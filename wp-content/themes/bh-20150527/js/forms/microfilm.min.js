!function(){"use strict";var r=angular.module("microfilmApp",[]).config(function(r){r.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"});r.controller("mfController",function(r,t,i,e,n){var o=BH_general.params.template,c=o+"/views/components/",a=BH_general.params.api,s=function(){r.microfilms=[],r.senderDetails={},r.rc.form.attempted=!1,r.form.$setPristine()},f=!1;r.__defineGetter__("success",function(){return f}),r.__defineSetter__("success",function(t){"boolean"==typeof t&&(f=t,1==t&&(r.error.code=null,s()))}),r.templates={countryList:c+"country-list.html",stateList:c+"state-list.html"},r.control=null,r.submitInProgress=!1,r.error={_code:null,get code(){return this._code},set code(t){this._code=t,null!==t&&(r.success=!1)}},r.senderDetails={},r.years=n.years,r.getMicrofilmData=function(){t.get(a+"microfilm-api.php").success(function(r){angular.forEach(r,function(r){i.microfilmData.push(r)})})},r.__defineGetter__("microfilmData",function(){return i.microfilmData}),r.__defineGetter__("microfilms",function(){return i.microfilms}),r.__defineSetter__("microfilms",function(r){i.microfilms=r}),r.__defineGetter__("letters",function(){return e.letters}),r.__defineGetter__("currentLetter",function(){return e.currentLetter}),r.__defineSetter__("currentLetter",function(r){e.currentLetter=r}),r.addMicrofilm=function(r){i.add(r)},r.removeMicrofilm=function(r){i.remove(r)},r.changeMicrofilm=function(r){i.change(r)},r.findMicrofilm=function(r){return i.findMicrofilm(r)},r.validateMicrofilms=function(){var t=!0;return angular.forEach(r.microfilms,function(r){r.valid||(t=!1)}),t},r.findMatch=function(r){return i.findMatch(r)},r.submitForm=function(){if(r.microfilms.length>0&&r.validateMicrofilms()&&null===r.control){r.submitInProgress=!0;var i={microfilms:{}};angular.forEach(r.microfilms,function(r,t){i.microfilms[t]=r.data});for(var e in r.senderDetails)i[e]=r.senderDetails[e];i=$.param(i),t.post(a+"microfilm-api.php",i).success(function(t){t.error?(r.error.code=t.error.code,r.error.message=t.error.message):t.success&&(r.success=!0),r.submitInProgress=!1})}}}),r.factory("MicrofilmManager",function(){var r=function(){this.microfilmData=[],this.microfilms=[]};return r.prototype={add:function(r){var t={data:{}};return r?(t.data.Microfilm=angular.copy(r.Microfilm),t.data.Type=angular.copy(r.Type),t.valid=!0):(t.data={},t.valid=!1),this.microfilms.push(t),t},findMicrofilm:function(r){var t=!1;return angular.forEach(this.microfilms,function(i){r==i.data.Microfilm&&(t=i)}),t},findMatch:function(r){var t=!1,i=function(r,t){var i=!0,e=["Microfilm"];return e.forEach(function(e){r[e]!=t[e]&&(i=!1)}),i};return angular.forEach(this.microfilms,function(e){i(r,e.data)&&(t=e)}),t},findMicrofilmData:function(r){var t=!1;return angular.forEach(this.microfilmData,function(i){r==i.Microfilm&&(t=i)}),t},remove:function(r){var t=this.findMicrofilm(r);t&&this.microfilms.splice(this.microfilms.indexOf(t),1)},change:function(r){var t=this.findMicrofilmData(r.data.Microfilm);t?(r.data.Type=angular.copy(t.Type),r.valid=!0):r.valid=!1}},new r}),r.service("SortService",function(){this.letters=[];for(var r=65;90>=r;r++)this.letters.push(String.fromCharCode(r));this.currentLetter=this.letters[0]}),r.service("YearsService",function(){this.years=[];for(var r=(new Date).getFullYear()-2e3,t=r;99>=t;t++)this.years.push(t)}),r.filter("sortByLetter",function(){return function(r,t){var i=[];return angular.forEach(r,function(r){r.Town[0].toUpperCase()===t&&i.push(r)}),i}}),r.directive("showOnHover",function(){return{restrict:"A",scope:{showOnHover:"@"},link:function(r,t){var i=r.showOnHover+"-show";t.on("mouseenter",function(){$("."+r.showOnHover).addClass(i)}),t.on("mouseleave",function(){$("."+r.showOnHover).removeClass(i)})}}}),rcSubmitDirective&&r.directive(rcSubmitDirective)}(window,document);